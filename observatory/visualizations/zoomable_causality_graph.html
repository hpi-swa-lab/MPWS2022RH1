<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Zoomable Causality Graph</title>

        <link rel="stylesheet" type="text/css" href="/assets/css/dist/main.css" />
        <script src="../assets/js/dist/observatory.umd.js"></script>
    </head>

    <body>
        <div class="zcg-control-container">
            <h1>Visualization of Message Graphs using a Force Simulation</h1>

            <br />

            <table>
                <tr>
                    <td><label for="input-file-entry-points">Entry points file:</label></td>
                    <td>
                        <input
                            type="file"
                            id="input-file-entry-points"
                            name="select-dataset"
                            accept=".csv"
                        />
                    </td>
                </tr>
                <tr>
                    <td><label for="input-file-methods">Methods file:</label></td>
                    <td>
                        <input
                            type="file"
                            id="input-file-methods"
                            name="select-dataset"
                            accept=".csv"
                        />
                    </td>
                </tr>
                <tr>
                    <td><label for="input-file-direct-edges">Direct edges file:</label></td>
                    <td>
                        <input
                            type="file"
                            id="input-file-direct-edges"
                            name="select-dataset"
                            accept=".csv"
                        />
                    </td>
                </tr>
                <tr>
                    <td><label for="input-file-virtual-edges">Virtual edges file:</label></td>
                    <td>
                        <input
                            type="file"
                            id="input-file-virtual-edges"
                            name="select-dataset"
                            accept=".csv"
                        />
                    </td>
                </tr>
            </table>

            <br />

            <button id="buttonConfirm">
                <div id="loader" class="zcg-loader"></div>
                <p id="buttonText">Observe!</p>
            </button>
        </div>
        <div id="container" class="zcg-svg-container"></div>

        <script type="module">
            const entryPointsInput = document.getElementById('input-file-entry-points')
            const methodsInput = document.getElementById('input-file-methods')
            const directEdgesInput = document.getElementById('input-file-direct-edges')
            const virtualEdgesInput = document.getElementById('input-file-virtual-edges')

            const loader = document.getElementById('loader')
            const buttonText = document.getElementById('buttonText')
            const buttonConfirm = document.getElementById('buttonConfirm')

            buttonConfirm.addEventListener('click', async () => {
                const errorMessages = []

                if (!entryPointsInput.files.length > 0) {
                    errorMessages.push('No entry points file given')
                }
                if (!methodsInput.files.length > 0) {
                    errorMessages.push('No methods file given')
                }
                if (!directEdgesInput.files.length > 0) {
                    errorMessages.push('No direct edges file given')
                }
                if (!virtualEdgesInput.files.length > 0) {
                    errorMessages.push('No virtual edges file given')
                }

                if (errorMessages.length > 0) {
                    let alertMessage = ''
                    errorMessages.forEach((message) => (alertMessage += `${message}\n\n`))
                    alert(alertMessage)

                    return
                }

                loader.style.visibility = 'visible'
                buttonText.style.visibility = 'hidden'

                const visualization = await Observatory.generateZoomableausalityGraph(
                    entryPointsInput.files[0],
                    methodsInput.files[0],
                    directEdgesInput.files[0],
                    virtualEdgesInput.files[0]
                )

                visualization.continueSimulation(() => {
                    loader.style.visibility = 'hidden'
                    buttonText.style.visibility = 'visible'
                })
            })
        </script>
    </body>
</html>
